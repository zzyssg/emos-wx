<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.emoswx.db.dao.TbMeetingDao">
    <insert id="insertMeeting" parameterType="com.example.emoswx.db.pojo.TbMeeting">
        insert into tb_meeting
        set
        uuid = #{uuid},

        title = #{title},
        creator_id = #{creatorId},
        date = #{date},
        <if test="place != null">
            place = #{place},
        </if>
        start = #{start},
        end = #{end},
        type = #{type},
        members = #{members},
        <if test="desc != null">
            `desc` = #{desc},
        </if>
        instance_id = #{instanceId},
        status = #{status},
        create_time = #{createTime}
    </insert>

    <!--分页查询-->
    <!--TODO 怎么这样写sql，如果自己写怎么写？-->
    <select id="searchMyMeetingListByPage" parameterType="hashmap" resultType="hashmap">
        select
        m.id,m.uuid,m.title,
        u2.name,DATE_FORMAT(m.date,'%Y年%m月%d日') as date,
        DATE_FORMAT(m.start,'%H:%i') as start,
        DATE_FORMAT(m.end,'%H:%i') as end,
        m.place,
        m.type,
        m.status,
        m.desc,
        u2.photo,
        TIMESTAMPDIFF(HOUR,CONCAT(m.date," ",m.start),CONCAT(m.date," ",m.end)) as hour
        from tb_meeting m
        join tb_user u1 on JSON_CONTAINS(m.members,CAST(u1.id as char))
        join tb_user u2 on m.creator_id = u2.id
        where u1.id = #{userId} and u1.status = 1 and u2.status = 1 and m.status in (3,4)
        order by m.date,m.start,m.end
        limit #{start},#{length}
    </select>

</mapper>
